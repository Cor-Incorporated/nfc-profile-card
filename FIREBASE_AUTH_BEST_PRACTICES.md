# Firebase認証のベストプラクティス実装

## 実装した機能

このプロジェクトでは、Firebase公式ドキュメントに基づいて以下の認証機能を実装しました：

### 1. 基本的な認証機能
- ✅ メール/パスワードによるサインアップとサインイン
- ✅ Googleアカウントによるソーシャルログイン
- ✅ 認証状態の永続化（ブラウザを閉じても維持）
- ✅ 自動的なセッション管理

### 2. セキュリティ機能
- ✅ メールアドレス確認機能
  - 新規登録時に確認メール自動送信
  - 確認メールの再送信機能
  - 未確認時の警告表示
- ✅ パスワードリセット機能
  - パスワード忘れ時のリセットメール送信
  - セキュアなリセットフロー
- ✅ パスワードの強度チェック（6文字以上）

### 3. エラーハンドリング
- ✅ 包括的なエラーメッセージの日本語化
- ✅ ユーザーフレンドリーなエラー表示
- ✅ ネットワークエラーの処理
- ✅ レート制限の処理

### 4. UX改善
- ✅ ローディング状態の表示
- ✅ 成功メッセージの表示
- ✅ フォームバリデーション
- ✅ 自動リダイレクト

## アーキテクチャ

```
src/
├── contexts/
│   └── AuthContext.tsx      # 認証ロジックの中央管理
├── app/
│   ├── signin/
│   │   └── page.tsx         # サインイン/サインアップページ
│   └── dashboard/
│       └── page.tsx         # 保護されたダッシュボード
├── lib/
│   └── firebase.ts          # Firebase設定と初期化
└── middleware.ts            # ルート保護（簡略化）
```

## 実装のポイント

### 1. AuthContext（認証コンテキスト）
```typescript
// 主要な機能
- signInWithEmail: メールでのサインイン
- signUpWithEmail: メールでのサインアップ（確認メール送信付き）
- signInWithGoogle: Googleアカウントでのサインイン
- resetPassword: パスワードリセット
- resendVerificationEmail: 確認メール再送信
- signOut: サインアウト
```

### 2. エラーハンドリング
すべてのFirebaseエラーコードを日本語メッセージに変換：
- `auth/user-not-found` → "アカウントが見つかりません"
- `auth/wrong-password` → "パスワードが間違っています"
- `auth/email-already-in-use` → "このメールアドレスは既に使用されています"
- その他多数のエラーケースに対応

### 3. セキュリティベストプラクティス
- パスワードの最小長チェック
- メール確認の強制
- セキュアなパスワードリセットフロー
- XSS攻撃の防止（React標準）
- CSRF攻撃の防止（Firebase標準）

## 使用方法

### 新規登録
1. サインインページで「新規登録」タブを選択
2. メールアドレスとパスワードを入力
3. アカウント作成後、確認メールが自動送信される
4. メール内のリンクをクリックして確認完了

### サインイン
1. メールアドレスとパスワードでログイン
2. またはGoogleアカウントでワンクリックログイン

### パスワードリセット
1. サインインページで「パスワードをお忘れですか？」をクリック
2. 登録メールアドレスを入力
3. リセットメールを受信し、リンクから新パスワードを設定

## 今後の拡張可能性

- [ ] 多要素認証（MFA）の追加
- [ ] その他のソーシャルログイン（GitHub、Twitter等）
- [ ] カスタムクレームによる権限管理
- [ ] アカウント削除機能
- [ ] プロフィール画像のアップロード
- [ ] メールアドレス変更機能

## トラブルシューティング

### 認証が機能しない場合
1. Firebase Consoleで認証プロバイダが有効になっているか確認
2. 環境変数が正しく設定されているか確認
3. Firebase Consoleの承認済みドメインにlocalhostが追加されているか確認

### Googleサインインが機能しない場合
1. Google Cloud ConsoleでOAuth 2.0の設定を確認
2. 承認済みのJavaScript生成元を確認
3. ポップアップブロッカーが無効になっているか確認

### メールが届かない場合
1. スパムフォルダを確認
2. Firebase Consoleのメールテンプレート設定を確認
3. Firebase の送信制限に達していないか確認

## 参考資料

- [Firebase Auth 公式ドキュメント](https://firebase.google.com/docs/auth/web/start?hl=ja)
- [パスワード認証](https://firebase.google.com/docs/auth/web/password-auth?hl=ja)
- [Google認証](https://firebase.google.com/docs/auth/web/google-signin?hl=ja)
- [エラーハンドリング](https://firebase.google.com/docs/auth/admin/errors?hl=ja)